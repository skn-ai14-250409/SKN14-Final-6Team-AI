<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qook ì±—ë´‡ - Qook</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/chat.css" rel="stylesheet">
    <link href="/static/css/navigation.css" rel="stylesheet">
    <!-- hjs ìˆ˜ì •: ë§ˆì´í˜ì´ì§€ íƒ­ í†µí•©ì„ ìœ„í•´ mypage.css ì¶”ê°€ -->
    <link href="/static/css/mypage.css" rel="stylesheet">
    <!-- hjs ìˆ˜ì •: ì•ˆì „í•œ ì‚¬ìš©ì ID ì „ë‹¬ìš© ë©”íƒ€ -->
    <meta name="current-user-id" content="{{ current_user if current_user else '' }}">
</head>
<body class="bg-gray-50 font-sans">
    <!-- í—¤ë” -->
    <header class="bg-white shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-6">
        
        <!-- ì™¼ìª½: ë¡œê³  -->
        <div class="flex items-center">
            <a href="/" class="flex items-center">
            <img src="{{ url_for('static', path='/images/qook_logo.png') }}" alt="Qook ë¡œê³ " class="h-10 w-auto" loading="lazy">
            <span class="text-3xl font-bold text-green-600 leading-none">Qook</span>
            </a>
        </div>
        
        <!-- ì¤‘ì•™: ì±—ë´‡ / ë§ˆì´í˜ì´ì§€ ë²„íŠ¼ -->
        <div class="flex items-center space-x-2">
            <button id="navChatbot" onclick="switchTopTab('chatbot')" class="nav-btn active px-4 py-2 bg-green-600 text-white rounded-lg font-medium transition duration-300 hover:bg-green-700">
            <i class="fas fa-robot mr-2"></i>ì±—ë´‡
            </button>
            <button id="navMypage" onclick="switchTopTab('mypage')" class="nav-btn px-4 py-2 bg-white text-green-600 rounded-lg font-medium transition duration-300 hover:bg-gray-50">
            <i class="fas fa-user mr-2"></i>ë§ˆì´í˜ì´ì§€
            </button>
        </div>

        <!-- ì˜¤ë¥¸ìª½: ë¡œê·¸ì•„ì›ƒ -->
        <div>
            <button onclick="logout()" class="text-gray-600 hover:text-red-600 px-3 py-2 rounded-md text-sm font-medium">
            ë¡œê·¸ì•„ì›ƒ
            </button>
        </div>
        </div>
    </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸ : 3ì»¬ëŸ¼ ë ˆì´ì•„ì›ƒ -->
    <div class="min-h-screen bg-gray-50">
        <div class="max-w-full mx-auto">
            <div id="chat-view" class="chat-layout flex">
                <!-- ì¢Œì¸¡: ë ˆì‹œí”¼/ì¦ê²¨ì°¾ê¸° íŒ¨ë„ -->
                <div class="left-panel">
                    <!-- íƒ­ ë²„íŠ¼ -->
                    <div class="panel-tabs">
                        <button id="recipeTab" class="tab-btn active" data-tab="recipes">
                            <i class="fas fa-utensils mr-2"></i>ë ˆì‹œí”¼
                        </button>
                        <button id="favoriteTab" class="tab-btn" data-tab="favorites">
                            <i class="fas fa-star mr-2"></i>ì¦ê²¨ì°¾ê¸°
                        </button>
                    </div>

                    <!-- ë ˆì‹œí”¼ ì„¹ì…˜ -->
                    <div id="recipesSection" class="panel-content active">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">
                            <i class="fas fa-utensils mr-2 text-green-500"></i>ë ˆì‹œí”¼
                        </h3>
                        <div id="recipesList">
                            <!-- ë ˆì‹œí”¼ ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ë Œë”ë§ë©ë‹ˆë‹¤ -->
                            <div class="empty-state">
                                <i class="fas fa-utensils text-gray-300 text-4xl mb-4"></i>
                                <p class="text-gray-500">ë ˆì‹œí”¼ë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”</p>
                            </div>
                        </div>
                    </div>

                    <!-- ì¦ê²¨ì°¾ê¸° ì„¹ì…˜ -->
                    <div id="favoritesSection" class="panel-content">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">
                            <i class="fas fa-star mr-2 text-green-500"></i>ì¦ê²¨ì°¾ê¸°
                        </h3>
                        <div class="empty-state">
                            <i class="fas fa-star text-gray-300 text-4xl mb-4"></i>
                            <p class="text-gray-500">ì €ì¥ëœ ë ˆì‹œí”¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                        </div>
                    </div>
                </div>

                <!-- ì¤‘ì•™: ì±—ë´‡ ì˜ì—­ -->
                <div class="center-panel">
                    <div class="chat-container" id="chatContainer">
                        <!-- ì‚¬ìš©ì ì´ë¦„ -->
                        <div class="chat-header">
                            <h2 class="text-2xl font-bold text-gray-800">{{ name }} ë‹˜ <span id="membershipBadge" class="align-middle ml-2 text-xs"></span></h2>
                            <div class="flex items-center space-x-4 mt-2">
                                <div id="sessionInfo" class="text-xs text-gray-500"></div>
                                <button id="clearChat" class="text-xs text-red-500 hover:underline">
                                    <i class="fas fa-trash mr-1"></i>ì±„íŒ… ì§€ìš°ê¸°
                                </button>
                            </div>
                        </div>

                        <!-- ì±„íŒ…ì°½ -->
                        <div class="chat-messages" id="messages">
                            <!-- ì´ˆê¸° ë´‡ ë©”ì‹œì§€ -->
                            <div class="mb-4 message-animation">
                                <div class="flex items-start">
                                    <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                                        <i class="fas fa-robot text-green-600 text-sm"></i>
                                    </div>
                                    <div class="message-bubble-bot">
                                        ì•ˆë…•í•˜ì„¸ìš”! Qook ì±—ë´‡ì…ë‹ˆë‹¤. ì–´ë–¤ ë ˆì‹œí”¼ë¥¼ ì°¾ê³  ê³„ì‹ ê°€ìš”?
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- ë¹ ë¥¸ ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
                        <div class="quick-actions px-5 py-2 border-t border-gray-100">
                            <div class="flex flex-wrap gap-2">
                                <button class="quick-action px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs hover:bg-green-200 transition" data-message="ì¸ê¸° ìƒí’ˆ ì¶”ì²œí•´ì¤˜">
                                    ğŸ”¥ ì¸ê¸° ìƒí’ˆ
                                </button>
                                <button class="quick-action px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs hover:bg-yellow-200 transition" data-message="ì˜¤ëŠ˜ ì €ë… ë©”ë‰´ ì¶”ì²œí•´ì¤˜">
                                    ğŸ½ï¸ ì €ë… ë©”ë‰´
                                </button>
                                <button class="quick-action px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs hover:bg-blue-200 transition" data-message="ì¥ë°”êµ¬ë‹ˆ ë³´ì—¬ì£¼ì„¸ìš”">
                                    ğŸ›’ ì¥ë°”êµ¬ë‹ˆ
                                </button>
                                <button class="quick-action px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs hover:bg-purple-200 transition" data-message="ìœ ê¸°ë† ì•¼ì±„ ì¶”ì²œí•´ì¤˜">
                                    ğŸ¥¬ ìœ ê¸°ë†
                                </button>
                                <button id="vision-quick-btn" class="px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-xs hover:bg-orange-200 transition" title="ìŒì‹ ì‚¬ì§„ìœ¼ë¡œ ë ˆì‹œí”¼ ì°¾ê¸°" onclick="triggerImageUpload(); return false;">
                                    ğŸ“· ì‚¬ì§„ ë ˆì‹œí”¼
                                </button>
                            </div>
                        </div>

                        <!-- ì…ë ¥ì°½ -->
                        <form id="chatForm" class="chat-input">
                            <button type="button" class="input-btn" title="ìƒë‹´ì‚¬ ì—°ê²°">
                                <i class="fas fa-headset"></i>
                            </button>
                            <input type="text" id="messageInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." class="message-input">
                            <div class="input-buttons">
                                <button type="button" id="voiceCancel" class="input-btn hidden" title="ìŒì„± ì·¨ì†Œ">
                                    <i class="fas fa-times"></i>
                                </button>
                                <button type="button" id="voiceInput" class="input-btn" title="ìŒì„± ì…ë ¥">
                                    <i class="fas fa-microphone"></i>
                                </button>
                                <button type="submit" class="input-btn primary" title="ì „ì†¡">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </form>
                        
                        <!-- ìˆ¨ê²¨ì§„ íŒŒì¼ ì…ë ¥ -->
                        <input type="file" id="imageInput" accept="image/*" style="display: none;">
                    </div>
                </div>

                <!-- ìš°ì¸¡: ìƒí’ˆ/ì¥ë°”êµ¬ë‹ˆ íŒ¨ë„ -->
                <div class="right-panel">
                    <!-- íƒ­ ë²„íŠ¼ -->
                    <div class="panel-tabs">
                        <button id="productTab" class="tab-btn active" data-tab="products">
                            <i class="fas fa-shopping-bag mr-2"></i>ìƒí’ˆ
                        </button>
                        <button id="cartTab" class="tab-btn" data-tab="cart">
                            <i class="fas fa-shopping-cart mr-2"></i>ì¥ë°”êµ¬ë‹ˆ
                        </button>
                    </div>

                    <!-- ìƒí’ˆ ì„¹ì…˜ -->
                    <div id="productsSection" class="panel-content active hidden">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">
                            <i class="fas fa-shopping-bag mr-2 text-green-500"></i>ì¶”ì²œ ìƒí’ˆ
                        </h3>
                        <div id="productsList">
                            <!-- ìƒí’ˆ ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ë Œë”ë§ë©ë‹ˆë‹¤ -->
                            <div class="empty-state">
                                <i class="fas fa-shopping-bag text-gray-300 text-4xl mb-4"></i>
                                <p class="text-gray-500">ìƒí’ˆì„ ê²€ìƒ‰í•´ë³´ì„¸ìš”</p>
                            </div>
                        </div>
                    </div>

                    <!-- ì¥ë°”êµ¬ë‹ˆ ì„¹ì…˜ -->
                    <div id="cartSection" class="panel-content">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">
                            <i class="fas fa-shopping-cart mr-2 text-green-500"></i>ì¥ë°”êµ¬ë‹ˆ
                            <span id="cartCount" class="ml-2 px-2 py-1 bg-green-100 text-green-600 rounded-full text-sm">0</span>
                        </h3>
                        <!-- hjs ìˆ˜ì •: ì¥ë°”êµ¬ë‹ˆ ì„ íƒ íˆ´ë°”(ì „ì²´ ì„ íƒ/í•´ì œ, ì„ íƒ ì‚­ì œ) -->
                        <div class="flex items-center gap-2 mb-2">
                            <button id="cartSelectAll" class="px-2 py-1 text-xs border rounded hover:bg-gray-50">ì „ì²´ ì„ íƒ</button>
                            <button id="cartSelectNone" class="px-2 py-1 text-xs border rounded hover:bg-gray-50">ì „ì²´ í•´ì œ</button>
                        </div>
                        <div id="cartItems">
                            <!-- ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œë“¤ì´ ë™ì ìœ¼ë¡œ ë Œë”ë§ë©ë‹ˆë‹¤ -->
                            <div class="cart-empty p-4 text-center text-gray-500">
                                ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.
                            </div>
                        </div>

                        <div class="cart-summary mt-4 pt-4 border-t border-gray-200">
                            <div class="summary-row">
                                <span>ìƒí’ˆê¸ˆì•¡</span>
                                <span id="subtotalAmount">0ì›</span>
                            </div>
                            <div class="summary-row">
                                <span>í• ì¸ê¸ˆì•¡</span>
                                <span id="discountAmount" class="text-red-500">- 0ì›</span>
                            </div>
                            <div class="summary-row">
                                <span>ë°°ì†¡ë¹„</span>
                                <span id="shippingFee" class="text-purple-500">3,000ì›</span>
                            </div>
                            <div class="summary-row total">
                                <span>ì´ ê²°ì œê¸ˆì•¡</span>
                                <span id="totalAmount">0ì›</span>
                            </div>
                            <button id="checkoutButton" class="checkout-btn hidden">ê²°ì œí•˜ê¸°</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- hjs ìˆ˜ì •: ìƒìœ„ íƒ­ ì»¨í…Œì´ë„ˆ - ë§ˆì´í˜ì´ì§€ ë·° (ì´ˆê¸° hidden) -->
            <div id="mypage-view" class="hidden">
                <div class="flex">
                    <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
                    <div class="w-80 bg-green-500 min-h-screen flex-shrink-0">
                        <div class="p-8">
                            <!-- ì‚¬ìš©ì ì •ë³´ ì„¹ì…˜ -->
                            <div class="text-center mb-8">
                                <div class="w-24 h-24 bg-gray-600 rounded-full mx-auto mb-4 flex items-center justify-center">
                                    <i class="fas fa-user text-white text-3xl"></i>
                                </div>
                                <h2 class="text-2xl font-bold text-white mb-4"><span class="sidebar-user-name">ì‚¬ìš©ì</span> ë‹˜</h2>
                                <button class="bg-white text-green-600 px-6 py-2 rounded-lg font-semibold hover:bg-gray-100 transition duration-200" onclick="editProfile()">
                                    íšŒì›ì •ë³´ ìˆ˜ì •
                                </button>
                            </div>
                            <div class="space-y-3">
                                <div class="menu-item flex items-center text-white py-3 px-4 hover:bg-green-400 rounded-lg cursor-pointer transition duration-200" data-menu="orders" onclick="showContent('orders')">
                                    <i class="fas fa-clock text-lg mr-4"></i>
                                    <span class="font-medium">ì£¼ë¬¸ë‚´ì—­ í™•ì¸</span>
                                </div>
                                <div class="menu-item flex items-center text-white py-3 px-4 hover:bg-green-400 rounded-lg cursor-pointer transition duration-200" data-menu="delivery" onclick="showContent('delivery')">
                                    <i class="fas fa-truck text-lg mr-4"></i>
                                    <span class="font-medium">ë°°ì†¡ë‚´ì—­ í™•ì¸</span>
                                </div>
                                <div class="menu-item flex items-center text-white py-3 px-4 hover:bg-green-400 rounded-lg cursor-pointer transition duration-200" data-menu="chat" onclick="showContent('chat')">
                                    <i class="fas fa-comments text-lg mr-4"></i>
                                    <span class="font-medium">ì±„íŒ… íˆìŠ¤í† ë¦¬</span>
                                </div>
                                <div class="menu-item flex items-center text-white py-3 px-4 hover:bg-green-400 rounded-lg cursor-pointer transition duration-200" data-menu="recipes" onclick="showContent('recipes')">
                                    <i class="fas fa-utensils text-lg mr-4"></i>
                                    <span class="font-medium">ì €ì¥í•œ ë ˆì‹œí”¼</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- ì½˜í…ì¸  ì˜ì—­ -->
                    <div class="flex-1 p-8">
                        <div id="content-orders" class="content-section active">
                            <div class="mb-6">
                                <h2 class="text-3xl font-bold text-gray-800 mb-2">ì£¼ë¬¸ ë‚´ì—­</h2>
                                <p class="text-gray-600">ìµœê·¼ ì£¼ë¬¸ì„ í™•ì¸í•˜ì„¸ìš”.</p>
                            </div>
                            <div id="ordersList" class="space-y-4"></div>
                        </div>
                        <div id="content-delivery" class="content-section hidden">
                            <div class="mb-6">
                                <h2 class="text-3xl font-bold text-gray-800 mb-2">ë°°ì†¡ ë‚´ì—­</h2>
                                <p class="text-gray-600">ë°°ì†¡ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                            </div>
                            <div id="deliveryList" class="space-y-4"></div>
                        </div>
                        <div id="content-chat" class="content-section hidden">
                            <div class="mb-6">
                                <h2 class="text-3xl font-bold text-gray-800 mb-2">ì±„íŒ… íˆìŠ¤í† ë¦¬</h2>
                                <p class="text-gray-600">AI ì±—ë´‡ê³¼ì˜ ëŒ€í™” ë‚´ì—­ì„ í™•ì¸í•˜ì„¸ìš”.</p>
                            </div>
                            <div id="chatHistory" class="space-y-4"></div>
                        </div>
                        <div id="content-recipes" class="content-section hidden">
                            <div class="mb-6">
                                <h2 class="text-3xl font-bold text-gray-800 mb-2">ì €ì¥í•œ ë ˆì‹œí”¼</h2>
                                <p class="text-gray-600">ì¦ê²¨ì°¾ê¸°í•œ ë ˆì‹œí”¼ ëª©ë¡ì…ë‹ˆë‹¤.</p>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                        </div>
                        <div id="content-profile" class="content-section hidden p-8">
                            <div class="mb-6">
                                <h2 class="text-3xl font-bold text-gray-800 mb-2">ê°œì¸ì •ë³´ ìˆ˜ì •</h2>
                                <p class="text-gray-600">íšŒì›ë‹˜ì˜ ê°œì¸ì •ë³´ë¥¼ ìˆ˜ì •í•˜ì„¸ìš”.</p>
                            </div>

                            <form id="profileForm" class="space-y-6">
                                <!-- ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
                                <div class="bg-gray-50 rounded-lg p-6">
                                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                        <i class="fas fa-id-card text-blue-500 mr-2"></i>
                                        ê¸°ë³¸ ì •ë³´
                                    </h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">íšŒì› ì•„ì´ë””</label>
                                            <input type="text" id="profileUserId" class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-lg text-gray-500" readonly>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">ì´ë¦„ *</label>
                                            <input type="text" id="profileName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">ì´ë©”ì¼ *</label>
                                            <input type="email" id="profileEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">ì „í™”ë²ˆí˜¸</label>
                                            <input type="tel" id="profilePhone" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="010-0000-0000">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">ìƒë…„ì›”ì¼</label>
                                            <input type="date" id="profileBirthDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">ë‚˜ì´</label>
                                            <input type="number" id="profileAge" min="1" max="150" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                        </div>
                                    </div>

                                    <div class="mt-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">ì£¼ì†Œ</label>
                                        <input type="text" id="profileAddress" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                    </div>

                                    <div class="mt-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">ìš°í¸ë²ˆí˜¸</label>
                                        <input type="text" id="profilePostNum" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" maxlength="10">
                                    </div>
                                </div>

                                <!-- ì¶”ê°€ ì •ë³´ ì„¹ì…˜ -->
                                <div class="bg-green-50 rounded-lg p-6">
                                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                        <i class="fas fa-leaf text-green-500 mr-2"></i>
                                        ì‹í’ˆ ì„ í˜¸ë„ ì •ë³´
                                    </h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">ì„±ë³„</label>
                                            <div class="flex space-x-4">
                                                <label class="flex items-center">
                                                    <input type="radio" name="gender" value="M" class="text-green-500 focus:ring-green-500">
                                                    <span class="ml-2 text-sm text-gray-700">ë‚¨ì„±</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="radio" name="gender" value="F" class="text-green-500 focus:ring-green-500">
                                                    <span class="ml-2 text-sm text-gray-700">ì—¬ì„±</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">ê°€êµ¬ êµ¬ì„±ì› ìˆ˜</label>
                                            <input type="number" id="profileHouseHold" min="1" max="20" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                        </div>
                                        <div class="md:col-span-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" id="profileVegan" class="text-green-500 focus:ring-green-500 rounded">
                                                <span class="ml-2 text-sm text-gray-700">ë¹„ê±´ (ì±„ì‹ì£¼ì˜ì)</span>
                                            </label>
                                        </div>
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">ì•Œë ˆë¥´ê¸° ì •ë³´</label>
                                            <input type="text" id="profileAllergy" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="ì˜ˆ: ê²¬ê³¼ë¥˜, í•´ì‚°ë¬¼, ìœ ì œí’ˆ">
                                        </div>
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">ì‹«ì–´í•˜ëŠ” ìŒì‹</label>
                                            <input type="text" id="profileUnfavorite" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="ì˜ˆ: ì–‘íŒŒ, ë‹¹ê·¼, í”¼ë§">
                                        </div>
                                    </div>
                                </div>

                                <!-- ë©¤ë²„ì‹­ ì„¹ì…˜ -->
                                <div class="bg-yellow-50 rounded-lg p-6">
                                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                        <i class="fas fa-crown text-yellow-500 mr-2"></i>
                                        ë©¤ë²„ì‹­ ì •ë³´
                                    </h3>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">í˜„ì¬ ë©¤ë²„ì‹­ ë“±ê¸‰</label>
                                        <input type="text" id="profileMembership" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-600 cursor-not-allowed" placeholder="ë©¤ë²„ì‹­ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...">
                                        <p class="text-xs text-gray-500 mt-1">
                                            <i class="fas fa-info-circle mr-1"></i>
                                            ë©¤ë²„ì‹­ ë³€ê²½ì€ ê³ ê°ì„¼í„°ë¥¼ í†µí•´ ë¬¸ì˜í•´ì£¼ì„¸ìš”.
                                        </p>
                                    </div>
                                </div>

                                <!-- ë²„íŠ¼ ì„¹ì…˜ -->
                                <div class="flex justify-end space-x-4 pt-6">
                                    <button type="button" onclick="cancelProfileEdit()" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-200">
                                        <i class="fas fa-times mr-2"></i>ì·¨ì†Œ
                                    </button>
                                    <button type="submit" onclick="saveProfile(); return false;" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition duration-200">
                                        <i class="fas fa-save mr-2"></i>ì €ì¥
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì£¼ë¬¸ ì •ë³´ ì„¹ì…˜ (ìˆ¨ê²¨ì§„ ìƒíƒœ) -->
    <!-- <div id="orderSection" class="hidden"> -->
        <!-- <div id="orderInfo"></div> -->
    <!-- </div> -->

    <!-- JavaScript -->
    <!-- hjs ìˆ˜ì •: ë‹¨ì¼ í˜ì´ì§€ íƒ­ ëª¨ë“œì—ì„œëŠ” navigation.jsë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. -->
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/ui-helpers.js"></script>
    <!-- hjs ìˆ˜ì •: ì¥ë°”êµ¬ë‹ˆ/ê²°ì œ ëª¨ë“ˆ ë¶„ë¦¬ -->
    <script src="/static/js/chat-mod-cart.js"></script>
    <!-- hjs ìˆ˜ì •: ì œí’ˆ/ë ˆì‹œí”¼/ìŒì„±/ì—…ë¡œë“œ/CS ëª¨ë“ˆ ë¡œë“œ -->
    <script src="/static/js/chat-mod-products.js"></script>
    <script src="/static/js/chat-mod-recipes.js"></script>
    <script src="/static/js/chat-mod-voice.js"></script>
    <script src="/static/js/chat-mod-upload.js"></script>
    <script src="/static/js/chat-mod-cs.js"></script>
    <!-- hjs ìˆ˜ì •: CS ì¦ë¹™ ì „ìš© ëª¨ë“ˆ ë¡œë“œ -->
    <script src="/static/js/cs_evidence.js"></script>
    <script src="/static/js/markdown.js"></script>
    <script src="/static/js/chat-mod-vision.js"></script>
    <!-- hjs ìˆ˜ì •: ì „ì—­ ì‚¬ìš©ì ID ì£¼ì…(ë©”íƒ€ì—ì„œ ì•ˆì „í•˜ê²Œ ì½ê¸°) -->
    <script>
        (function(){
            var meta = document.querySelector('meta[name="current-user-id"]');
            var uid = meta && meta.content ? meta.content.trim() : '';
            window.CURRENT_USER_ID = uid ? uid : null;
            // hjs ìˆ˜ì •: ë©¤ë²„ì‹­ ë°°ì§€ í‘œê¸°
            function badgeHtml(tier){
                var t = String(tier||'').toLowerCase();
                if (t==='gold')   return '<span class="inline-flex items-center px-2 py-0.5 rounded bg-yellow-100 text-yellow-700">GOLD</span>';
                if (t==='premium')return '<span class="inline-flex items-center px-2 py-0.5 rounded bg-purple-100 text-purple-700">PREMIUM</span>';
                if (t==='basic')  return '<span class="inline-flex items-center px-2 py-0.5 rounded bg-gray-100 text-gray-700">BASIC</span>';
                return '';
            }
            fetch('/api/profile/get', { credentials:'include' })
              .then(function(r){ return r.json(); })
              .then(function(d){
                  var tier = (d && d.user && d.user.membership) ? d.user.membership : null;
                  if (!tier) return;
                  var chatBadge = document.getElementById('membershipBadge');
                  var myBadge = document.getElementById('mypageMembershipBadge');
                  if (chatBadge) chatBadge.innerHTML = badgeHtml(tier);
                  if (myBadge) myBadge.innerHTML = badgeHtml(tier);
              }).catch(function(){});
        })();
    </script>
    <script src="/static/js/chat.js"></script>
    <!-- hjs ìˆ˜ì •: ë§ˆì´í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸ í¬í•¨ (íƒ­ ëª¨ë“œ ê°€ë“œ ì‚¬ìš©) -->
    <script src="/static/js/mypage.js"></script>
    
    <!-- íƒ­ ê¸°ëŠ¥ ì¶”ê°€ -->
    <script>
        // hjs ìˆ˜ì •: ìƒë‹¨ ì±—ë´‡/ë§ˆì´í˜ì´ì§€ ì „í™˜
        function switchTopTab(target){
            const chatView = document.getElementById('chat-view');
            const myView = document.getElementById('mypage-view');
            const btnChat = document.getElementById('navChatbot');
            const btnMy = document.getElementById('navMypage');
            if (target === 'mypage'){
                chatView.classList.add('hidden');
                myView.classList.remove('hidden');
                // ë§ˆì´í˜ì´ì§€ ì„ íƒ: ë§ˆì´í˜ì´ì§€ ë²„íŠ¼ì€ ì§„í•œ ë…¹ìƒ‰ ë°°ê²½ + í°ê¸€ì”¨
                btnChat.className = 'nav-btn px-4 py-2 bg-white text-green-600 rounded-lg font-medium transition duration-300 hover:bg-gray-50';
                btnMy.className = 'nav-btn active px-4 py-2 bg-green-600 text-white rounded-lg font-medium transition duration-300 hover:bg-green-700';
                try { showContent('orders'); } catch(_){ }
            } else {
                myView.classList.add('hidden');
                chatView.classList.remove('hidden');
                // ì±—ë´‡ ì„ íƒ: ì±—ë´‡ ë²„íŠ¼ì€ ì§„í•œ ë…¹ìƒ‰ ë°°ê²½ + í°ê¸€ì”¨
                btnMy.className = 'nav-btn px-4 py-2 bg-white text-green-600 rounded-lg font-medium transition duration-300 hover:bg-gray-50';
                btnChat.className = 'nav-btn active px-4 py-2 bg-green-600 text-white rounded-lg font-medium transition duration-300 hover:bg-green-700';
            }
        }
        // íƒ­ ì „í™˜ ê¸°ëŠ¥
        function initializeTabs() {
            // ì¢Œì¸¡ íŒ¨ë„ íƒ­ (ë ˆì‹œí”¼/ì¦ê²¨ì°¾ê¸°)
            const leftTabs = document.querySelectorAll('.left-panel .tab-btn');
            const leftContents = document.querySelectorAll('.left-panel .panel-content');
            
            leftTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.dataset.tab;
                    
                    // íƒ­ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
                    leftTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // ì½˜í…ì¸  í‘œì‹œ/ìˆ¨ê¹€
                    leftContents.forEach(content => {
                        if (content.id === targetTab + 'Section') {
                            content.classList.add('active');
                        } else {
                            content.classList.remove('active');
                        }
                    });
                });
            });
            
            // ìš°ì¸¡ íŒ¨ë„ íƒ­ (ìƒí’ˆ/ì¥ë°”êµ¬ë‹ˆ)
            const rightTabs = document.querySelectorAll('.right-panel .tab-btn');
            const rightContents = document.querySelectorAll('.right-panel .panel-content');
            
            rightTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.dataset.tab;
                    
                    // íƒ­ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
                    rightTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // ì½˜í…ì¸  í‘œì‹œ/ìˆ¨ê¹€
                    rightContents.forEach(content => {
                        if (content.id === targetTab + 'Section') {
                            content.classList.add('active');
                        } else {
                            content.classList.remove('active');
                        }
                    });
                });
            });
        }

        // ì¦ê²¨ì°¾ê¸° í† ê¸€ ê¸°ëŠ¥
        function toggleFavorite(button) {
            const icon = button.querySelector('i');
            if (icon.classList.contains('text-gray-300')) {
                icon.classList.remove('text-gray-300');
                icon.classList.add('text-yellow-400');
            } else {
                icon.classList.remove('text-yellow-400');
                icon.classList.add('text-gray-300');
            }
        }

    
        // hjs ìˆ˜ì •: DOM ë¡œë“œ ì‹œ ìƒ˜í”Œ ë¡œì§ ì œê±°, ì‹¤ì œ UIë§Œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            initializeTabs();
            // hjs ìˆ˜ì •: ì¹´íŠ¸ ì„ íƒ íˆ´ë°” ì´ë²¤íŠ¸ ë°”ì¸ë”©
            const selectAll = document.getElementById('cartSelectAll');
            const selectNone = document.getElementById('cartSelectNone');
            const removeSel = document.getElementById('cartRemoveSelected');
            if (selectAll){ selectAll.addEventListener('click', ()=>{ document.querySelectorAll('.cart-select').forEach(cb=>{ cb.checked = true; }); }); }
            if (selectNone){ selectNone.addEventListener('click', ()=>{ document.querySelectorAll('.cart-select').forEach(cb=>{ cb.checked = false; }); }); }
            if (removeSel){ removeSel.addEventListener('click', ()=>{ try { if (window.ChatCart) ChatCart.handleRemoveSelected(window._chatbot); } catch(_){} }); }
        });
    </script>
    
    <!-- ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ -->
    <script>
        
         async function logout() {
            // hjs ìˆ˜ì •: ê°„ë‹¨í•œ í´ë°± ì¶”ê°€ â€” /auth/logout ì‹¤íŒ¨ ì‹œ /auth/logout-beacon í˜¸ì¶œ
            const clearLocal = () => {
              try {
                const u = JSON.parse(localStorage.getItem('user_info')||'{}');
                const uid = u.user_id || '';
                localStorage.removeItem('access_token');
                if (uid){
                  localStorage.removeItem(`chat_messages_${uid}`);
                  localStorage.removeItem(`chat_session_${uid}`);
                  localStorage.removeItem(`chat_pending_message_${uid}`);
                }
                localStorage.removeItem('user_info');
              } catch(_) {}
            };
            try {
              const token = localStorage.getItem('access_token');
              const headers = { 'Content-Type': 'application/json' };
              if (token) headers['Authorization'] = `Bearer ${token}`;
              const res = await fetch('/auth/logout', { method:'POST', headers, credentials:'include' });
              if (res.ok) { clearLocal(); window.location.href='/'; return; }
              // í´ë°±: ê¶Œí•œ ì—†ì´ ì¿ í‚¤ë§Œ ì œê±°
              await fetch('/auth/logout-beacon', { method:'POST', credentials:'include' });
              clearLocal(); window.location.href='/';
            } catch (e) {
              console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', e);
              try { await fetch('/auth/logout-beacon', { method:'POST', credentials:'include' }); } catch(_) {}
              clearLocal(); window.location.href='/';
            }
         }
    </script>
</body>
</html>
