<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qook Ï±óÎ¥á - Qook</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/chat.css" rel="stylesheet">
    <link href="/static/css/navigation.css" rel="stylesheet">
    <!-- hjs ÏàòÏ†ï: ÎßàÏù¥ÌéòÏù¥ÏßÄ ÌÉ≠ ÌÜµÌï©ÏùÑ ÏúÑÌï¥ mypage.css Ï∂îÍ∞Ä -->
    <link href="/static/css/mypage.css" rel="stylesheet">
    <!-- hjs ÏàòÏ†ï: ÏïàÏ†ÑÌïú ÏÇ¨Ïö©Ïûê ID Ï†ÑÎã¨Ïö© Î©îÌÉÄ -->
    <meta name="current-user-id" content="{{ current_user if current_user else '' }}">
</head>
<body class="bg-gray-50 font-sans">
    <!-- Ìó§Îçî -->
    <header class="bg-white shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-6">
        
        <!-- ÏôºÏ™Ω: Î°úÍ≥† -->
        <div class="flex items-center">
            <a href="/" class="flex items-center">
            <img src="{{ url_for('static', path='/images/qook_logo.png') }}" alt="Qook Î°úÍ≥†" class="h-10 w-auto" loading="lazy">
            <span class="text-3xl font-bold text-green-600 leading-none">Qook</span>
            </a>
        </div>
        
        <!-- Ï§ëÏïô: Ï±óÎ¥á / ÎßàÏù¥ÌéòÏù¥ÏßÄ Î≤ÑÌäº -->
        <div class="flex items-center space-x-2">
            <button id="navChatbot" onclick="switchTopTab('chatbot')" class="nav-btn active px-4 py-2 bg-green-600 text-white rounded-lg font-medium transition duration-300 hover:bg-green-700">
            <i class="fas fa-robot mr-2"></i>Ï±óÎ¥á
            </button>
            <button id="navMypage" onclick="switchTopTab('mypage')" class="nav-btn px-4 py-2 bg-white text-green-600 rounded-lg font-medium transition duration-300 border-2 border-green-600 hover:bg-gray-50">
            <i class="fas fa-user mr-2"></i>ÎßàÏù¥ÌéòÏù¥ÏßÄ
            </button>
        </div>

        <!-- Ïò§Î•∏Ï™Ω: Î°úÍ∑∏ÏïÑÏõÉ -->
        <div>
            <button onclick="logout()" class="text-gray-600 hover:text-red-600 px-3 py-2 rounded-md text-sm font-medium">
            Î°úÍ∑∏ÏïÑÏõÉ
            </button>
        </div>
        </div>
    </div>
    </header>

    <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏†: 3Ïª¨Îüº Î†àÏù¥ÏïÑÏõÉ -->
    <div class="min-h-screen bg-gray-50">
        <div class="max-w-full mx-auto">
            <div id="chat-view" class="chat-layout flex">
                <!-- Ï¢åÏ∏°: Î†àÏãúÌîº/Ï¶êÍ≤®Ï∞æÍ∏∞ Ìå®ÎÑê -->
                <div class="left-panel">
                    <!-- ÌÉ≠ Î≤ÑÌäº -->
                    <div class="panel-tabs">
                        <button id="recipeTab" class="tab-btn active" data-tab="recipes">
                            <i class="fas fa-utensils mr-2"></i>Î†àÏãúÌîº
                        </button>
                        <button id="favoriteTab" class="tab-btn" data-tab="favorites">
                            <i class="fas fa-star mr-2"></i>Ï¶êÍ≤®Ï∞æÍ∏∞
                        </button>
                    </div>

                    <!-- Î†àÏãúÌîº ÏÑπÏÖò -->
                    <div id="recipesSection" class="panel-content active">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">
                            <i class="fas fa-utensils mr-2 text-green-500"></i>Î†àÏãúÌîº
                        </h3>
                        <div id="recipesList">
                            <!-- Î†àÏãúÌîº Ïπ¥ÎìúÎì§Ïù¥ ÎèôÏ†ÅÏúºÎ°ú Î†åÎçîÎßÅÎê©ÎãàÎã§ -->
                            <div class="empty-state">
                                <i class="fas fa-utensils text-gray-300 text-4xl mb-4"></i>
                                <p class="text-gray-500">Î†àÏãúÌîºÎ•º Í≤ÄÏÉâÌï¥Î≥¥ÏÑ∏Ïöî</p>
                            </div>
                        </div>
                    </div>

                    <!-- Ï¶êÍ≤®Ï∞æÍ∏∞ ÏÑπÏÖò -->
                    <div id="favoritesSection" class="panel-content">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">
                            <i class="fas fa-star mr-2 text-green-500"></i>Ï¶êÍ≤®Ï∞æÍ∏∞
                        </h3>
                        <div class="empty-state">
                            <i class="fas fa-star text-gray-300 text-4xl mb-4"></i>
                            <p class="text-gray-500">Ï†ÄÏû•Îêú Î†àÏãúÌîºÍ∞Ä ÏóÜÏäµÎãàÎã§</p>
                        </div>
                    </div>
                </div>

                <!-- Ï§ëÏïô: Ï±óÎ¥á ÏòÅÏó≠ -->
                <div class="center-panel">
                    <div class="chat-container" id="chatContainer">
                        <!-- ÏÇ¨Ïö©Ïûê Ïù¥Î¶Ñ -->
                        <div class="chat-header">
                            <h2 class="text-2xl font-bold text-gray-800">{{ name }} Îãò <span id="membershipBadge" class="align-middle ml-2 text-xs"></span></h2>
                            <div class="flex items-center space-x-4 mt-2">
                                <div id="sessionInfo" class="text-xs text-gray-500"></div>
                                <button id="clearChat" class="text-xs text-red-500 hover:underline">
                                    <i class="fas fa-trash mr-1"></i>Ï±ÑÌåÖ ÏßÄÏö∞Í∏∞
                                </button>
                            </div>
                        </div>

                        <!-- Ï±ÑÌåÖÏ∞Ω -->
                        <div class="chat-messages" id="messages">
                            <!-- Ï¥àÍ∏∞ Î¥á Î©îÏãúÏßÄ -->
                            <div class="mb-4 message-animation">
                                <div class="flex items-start">
                                    <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                                        <i class="fas fa-robot text-green-600 text-sm"></i>
                                    </div>
                                    <div class="message-bubble-bot">
                                        ÏïàÎÖïÌïòÏÑ∏Ïöî! Qook Ï±óÎ¥áÏûÖÎãàÎã§. Ïñ¥Îñ§ Î†àÏãúÌîºÎ•º Ï∞æÍ≥† Í≥ÑÏã†Í∞ÄÏöî?
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- Îπ†Î•∏ Ïï°ÏÖò Î≤ÑÌäºÎì§ -->
                        <div class="quick-actions px-5 py-2 border-t border-gray-100">
                            <div class="flex flex-wrap gap-2">
                                <button class="quick-action px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs hover:bg-green-200 transition" data-message="Ïù∏Í∏∞ ÏÉÅÌíà Ï∂îÏ≤úÌï¥Ï§ò">
                                    üî• Ïù∏Í∏∞ ÏÉÅÌíà
                                </button>
                                <button class="quick-action px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs hover:bg-yellow-200 transition" data-message="Ïò§Îäò Ï†ÄÎÖÅ Î©îÎâ¥ Ï∂îÏ≤úÌï¥Ï§ò">
                                    üçΩÔ∏è Ï†ÄÎÖÅ Î©îÎâ¥
                                </button>
                                <button class="quick-action px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs hover:bg-blue-200 transition" data-message="Ïû•Î∞îÍµ¨Îãà Î≥¥Ïó¨Ï£ºÏÑ∏Ïöî">
                                    üõí Ïû•Î∞îÍµ¨Îãà
                                </button>
                                <button class="quick-action px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs hover:bg-purple-200 transition" data-message="Ïú†Í∏∞ÎÜç ÏïºÏ±Ñ Ï∂îÏ≤úÌï¥Ï§ò">
                                    ü•¨ Ïú†Í∏∞ÎÜç
                                </button>
                            </div>
                        </div>

                        <!-- ÏûÖÎ†•Ï∞Ω -->
                        <form id="chatForm" class="chat-input">
                            <button type="button" class="input-btn" title="ÏÉÅÎã¥ÏÇ¨ Ïó∞Í≤∞">
                                <i class="fas fa-headset"></i>
                            </button>
                            <input type="text" id="messageInput" placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." class="message-input">
                            <div class="input-buttons">
                                <button type="button" id="voiceCancel" class="input-btn hidden" title="ÏùåÏÑ± Ï∑®ÏÜå">
                                    <i class="fas fa-times"></i>
                                </button>
                                <button type="button" id="voiceInput" class="input-btn" title="ÏùåÏÑ± ÏûÖÎ†•">
                                    <i class="fas fa-microphone"></i>
                                </button>
                                <button type="submit" class="input-btn primary" title="Ï†ÑÏÜ°">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </form>
                        
                        <!-- Ïà®Í≤®ÏßÑ ÌååÏùº ÏûÖÎ†• -->
                        <input type="file" id="imageInput" accept="image/*" style="display: none;">
                    </div>
                </div>

                <!-- Ïö∞Ï∏°: ÏÉÅÌíà/Ïû•Î∞îÍµ¨Îãà Ìå®ÎÑê -->
                <div class="right-panel">
                    <!-- ÌÉ≠ Î≤ÑÌäº -->
                    <div class="panel-tabs">
                        <button id="productTab" class="tab-btn active" data-tab="products">
                            <i class="fas fa-shopping-bag mr-2"></i>ÏÉÅÌíà
                        </button>
                        <button id="cartTab" class="tab-btn" data-tab="cart">
                            <i class="fas fa-shopping-cart mr-2"></i>Ïû•Î∞îÍµ¨Îãà
                        </button>
                    </div>

                    <!-- ÏÉÅÌíà ÏÑπÏÖò -->
                    <div id="productsSection" class="panel-content active hidden">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">
                            <i class="fas fa-shopping-bag mr-2 text-green-500"></i>Ï∂îÏ≤ú ÏÉÅÌíà
                        </h3>
                        <div id="productsList">
                            <!-- ÏÉÅÌíà Ïπ¥ÎìúÎì§Ïù¥ ÎèôÏ†ÅÏúºÎ°ú Î†åÎçîÎßÅÎê©ÎãàÎã§ -->
                            <div class="empty-state">
                                <i class="fas fa-shopping-bag text-gray-300 text-4xl mb-4"></i>
                                <p class="text-gray-500">ÏÉÅÌíàÏùÑ Í≤ÄÏÉâÌï¥Î≥¥ÏÑ∏Ïöî</p>
                            </div>
                        </div>
                    </div>

                    <!-- Ïû•Î∞îÍµ¨Îãà ÏÑπÏÖò -->
                    <div id="cartSection" class="panel-content">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">
                            <i class="fas fa-shopping-cart mr-2 text-green-500"></i>Ïû•Î∞îÍµ¨Îãà
                            <span id="cartCount" class="ml-2 px-2 py-1 bg-green-100 text-green-600 rounded-full text-sm">0</span>
                        </h3>
                        <!-- hjs ÏàòÏ†ï: Ïû•Î∞îÍµ¨Îãà ÏÑ†ÌÉù Ìà¥Î∞î(Ï†ÑÏ≤¥ ÏÑ†ÌÉù/Ìï¥Ï†ú, ÏÑ†ÌÉù ÏÇ≠Ï†ú) -->
                        <div class="flex items-center gap-2 mb-2">
                            <button id="cartSelectAll" class="px-2 py-1 text-xs border rounded hover:bg-gray-50">Ï†ÑÏ≤¥ ÏÑ†ÌÉù</button>
                            <button id="cartSelectNone" class="px-2 py-1 text-xs border rounded hover:bg-gray-50">Ï†ÑÏ≤¥ Ìï¥Ï†ú</button>
                        </div>
                        
                        <div id="cartItems">
                            <!-- Ïû•Î∞îÍµ¨Îãà ÏïÑÏù¥ÌÖúÎì§Ïù¥ ÎèôÏ†ÅÏúºÎ°ú Î†åÎçîÎßÅÎê©ÎãàÎã§ -->
                            <div class="cart-empty p-4 text-center text-gray-500">
                                Ïû•Î∞îÍµ¨ÎãàÍ∞Ä ÎπÑÏñ¥ÏûàÏäµÎãàÎã§.
                            </div>
                        </div>

                        <div class="cart-summary mt-4 pt-4 border-t border-gray-200">
                            <div class="summary-row">
                                <span>ÏÉÅÌíàÍ∏àÏï°</span>
                                <span id="subtotalAmount">0Ïõê</span>
                            </div>
                            <div class="summary-row">
                                <span>Ìï†Ïù∏Í∏àÏï°</span>
                                <span id="discountAmount" class="text-red-500">- 0Ïõê</span>
                            </div>
                            <div class="summary-row">
                                <span>Î∞∞ÏÜ°ÎπÑ</span>
                                <span id="shippingFee" class="text-purple-500">3,000Ïõê</span>
                            </div>
                            <div class="summary-row total">
                                <span>Ï¥ù Í≤∞Ï†úÍ∏àÏï°</span>
                                <span id="totalAmount">0Ïõê</span>
                            </div>
                            <button id="checkoutButton" class="checkout-btn hidden">Í≤∞Ï†úÌïòÍ∏∞</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- hjs ÏàòÏ†ï: ÏÉÅÏúÑ ÌÉ≠ Ïª®ÌÖåÏù¥ÎÑà - ÎßàÏù¥ÌéòÏù¥ÏßÄ Î∑∞ (Ï¥àÍ∏∞ hidden) -->
            <div id="mypage-view" class="hidden">
                <div class="flex">
                    <!-- ÏôºÏ™Ω ÏÇ¨Ïù¥ÎìúÎ∞î -->
                    <div class="w-80 bg-green-500 min-h-screen flex-shrink-0">
                        <div class="p-8">
                            <div class="text-center mb-6">
                                <div class="w-20 h-20 bg-gray-600 rounded-full mx-auto mb-3 flex items-center justify-center">
                                    <i class="fas fa-user text-white text-2xl"></i>
                                </div>
                                <!-- hjs ÏàòÏ†ï: ÎßàÏù¥ÌéòÏù¥ÏßÄ ÏÉÅÎã®Ïóê ÏÇ¨Ïö©ÏûêÎ™Ö + Î©§Î≤ÑÏã≠ Î∞∞ÏßÄ ÌëúÏãú -->
                                <div class="flex items-center justify-center gap-2 mb-1">
                                    <span class="text-white font-bold">{{ name }}Îãò</span>
                                    <span id="mypageMembershipBadge" class="text-xs"></span>
                                </div>
                                <h2 class="text-xl font-bold text-white mb-2">ÎßàÏù¥ÌéòÏù¥ÏßÄ</h2>
                            </div>
                            <div class="space-y-3">
                                <div class="menu-item flex items-center text-white py-3 px-4 hover:bg-green-400 rounded-lg cursor-pointer transition duration-200" data-menu="orders" onclick="showContent('orders')">
                                    <i class="fas fa-clock text-lg mr-4"></i>
                                    <span class="font-medium">Ï£ºÎ¨∏ÎÇ¥Ïó≠ ÌôïÏù∏</span>
                                </div>
                                <div class="menu-item flex items-center text-white py-3 px-4 hover:bg-green-400 rounded-lg cursor-pointer transition duration-200" data-menu="delivery" onclick="showContent('delivery')">
                                    <i class="fas fa-truck text-lg mr-4"></i>
                                    <span class="font-medium">Î∞∞ÏÜ°ÎÇ¥Ïó≠ ÌôïÏù∏</span>
                                </div>
                                <div class="menu-item flex items-center text-white py-3 px-4 hover:bg-green-400 rounded-lg cursor-pointer transition duration-200" data-menu="chat" onclick="showContent('chat')">
                                    <i class="fas fa-comments text-lg mr-4"></i>
                                    <span class="font-medium">Ï±ÑÌåÖ ÌûàÏä§ÌÜ†Î¶¨</span>
                                </div>
                                <div class="menu-item flex items-center text-white py-3 px-4 hover:bg-green-400 rounded-lg cursor-pointer transition duration-200" data-menu="recipes" onclick="showContent('recipes')">
                                    <i class="fas fa-utensils text-lg mr-4"></i>
                                    <span class="font-medium">Ï†ÄÏû•Ìïú Î†àÏãúÌîº</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- ÏΩòÌÖêÏ∏† ÏòÅÏó≠ -->
                    <div class="flex-1 p-8">
                        <div id="content-orders" class="content-section active">
                            <div class="mb-6">
                                <h2 class="text-3xl font-bold text-gray-800 mb-2">Ï£ºÎ¨∏ ÎÇ¥Ïó≠</h2>
                                <p class="text-gray-600">ÏµúÍ∑º Ï£ºÎ¨∏ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.</p>
                            </div>
                            <div id="ordersList" class="space-y-4"></div>
                        </div>
                        <div id="content-delivery" class="content-section hidden">
                            <div class="mb-6">
                                <h2 class="text-3xl font-bold text-gray-800 mb-2">Î∞∞ÏÜ° ÎÇ¥Ïó≠</h2>
                                <p class="text-gray-600">Î∞∞ÏÜ° ÏÉÅÌÉúÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.</p>
                            </div>
                            <div id="deliveryList" class="space-y-4"></div>
                        </div>
                        <div id="content-chat" class="content-section hidden">
                            <div class="mb-6">
                                <h2 class="text-3xl font-bold text-gray-800 mb-2">Ï±ÑÌåÖ ÌûàÏä§ÌÜ†Î¶¨</h2>
                                <p class="text-gray-600">AI Ï±óÎ¥áÍ≥ºÏùò ÎåÄÌôî ÎÇ¥Ïó≠ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.</p>
                            </div>
                            <div id="chatHistory" class="space-y-4"></div>
                        </div>
                        <div id="content-recipes" class="content-section hidden">
                            <div class="mb-6">
                                <h2 class="text-3xl font-bold text-gray-800 mb-2">Ï†ÄÏû•Ìïú Î†àÏãúÌîº</h2>
                                <p class="text-gray-600">Ï¶êÍ≤®Ï∞æÍ∏∞Ìïú Î†àÏãúÌîº Î™©Î°ùÏûÖÎãàÎã§.</p>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ï£ºÎ¨∏ Ï†ïÎ≥¥ ÏÑπÏÖò (Ïà®Í≤®ÏßÑ ÏÉÅÌÉú) -->
    <!-- <div id="orderSection" class="hidden"> -->
        <!-- <div id="orderInfo"></div> -->
    <!-- </div> -->

    <!-- JavaScript -->
    <!-- hjs ÏàòÏ†ï: Îã®Ïùº ÌéòÏù¥ÏßÄ ÌÉ≠ Î™®ÎìúÏóêÏÑúÎäî navigation.jsÎ•º ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏäµÎãàÎã§. -->
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/ui-helpers.js"></script>
    <!-- hjs ÏàòÏ†ï: Ïû•Î∞îÍµ¨Îãà/Í≤∞Ï†ú Î™®Îìà Î∂ÑÎ¶¨ -->
    <script src="/static/js/chat-mod-cart.js"></script>
    <!-- hjs ÏàòÏ†ï: Ï†úÌíà/Î†àÏãúÌîº/ÏùåÏÑ±/ÏóÖÎ°úÎìú/CS Î™®Îìà Î°úÎìú -->
    <script src="/static/js/chat-mod-products.js"></script>
    <script src="/static/js/chat-mod-recipes.js"></script>
    <script src="/static/js/chat-mod-voice.js"></script>
    <script src="/static/js/chat-mod-upload.js"></script>
    <script src="/static/js/chat-mod-cs.js"></script>
    <!-- hjs ÏàòÏ†ï: CS Ï¶ùÎπô Ï†ÑÏö© Î™®Îìà Î°úÎìú -->
    <script src="/static/js/cs_evidence.js"></script>
    <script src="/static/js/markdown.js"></script>
    <!-- hjs ÏàòÏ†ï: Ï†ÑÏó≠ ÏÇ¨Ïö©Ïûê ID Ï£ºÏûÖ(Î©îÌÉÄÏóêÏÑú ÏïàÏ†ÑÌïòÍ≤å ÏùΩÍ∏∞) -->
    <script>
        (function(){
            var meta = document.querySelector('meta[name="current-user-id"]');
            var uid = meta && meta.content ? meta.content.trim() : '';
            window.CURRENT_USER_ID = uid ? uid : null;
            // hjs ÏàòÏ†ï: Î©§Î≤ÑÏã≠ Î∞∞ÏßÄ ÌëúÍ∏∞
            function badgeHtml(tier){
                var t = String(tier||'').toLowerCase();
                if (t==='gold')   return '<span class="inline-flex items-center px-2 py-0.5 rounded bg-yellow-100 text-yellow-700">GOLD</span>';
                if (t==='premium')return '<span class="inline-flex items-center px-2 py-0.5 rounded bg-purple-100 text-purple-700">PREMIUM</span>';
                if (t==='basic')  return '<span class="inline-flex items-center px-2 py-0.5 rounded bg-gray-100 text-gray-700">BASIC</span>';
                return '';
            }
            fetch('/api/profile/get', { credentials:'include' })
              .then(function(r){ return r.json(); })
              .then(function(d){
                  var tier = (d && d.user && d.user.membership) ? d.user.membership : null;
                  if (!tier) return;
                  var chatBadge = document.getElementById('membershipBadge');
                  var myBadge = document.getElementById('mypageMembershipBadge');
                  if (chatBadge) chatBadge.innerHTML = badgeHtml(tier);
                  if (myBadge) myBadge.innerHTML = badgeHtml(tier);
              }).catch(function(){});
        })();
    </script>
    <script src="/static/js/chat.js"></script>
    <!-- hjs ÏàòÏ†ï: ÎßàÏù¥ÌéòÏù¥ÏßÄ Ïä§ÌÅ¨Î¶ΩÌä∏ Ìè¨Ìï® (ÌÉ≠ Î™®Îìú Í∞ÄÎìú ÏÇ¨Ïö©) -->
    <script src="/static/js/mypage.js"></script>
    
    <!-- ÌÉ≠ Í∏∞Îä• Ï∂îÍ∞Ä -->
    <script>
        // hjs ÏàòÏ†ï: ÏÉÅÎã® Ï±óÎ¥á/ÎßàÏù¥ÌéòÏù¥ÏßÄ Ï†ÑÌôò
        function switchTopTab(target){
            console.log('switchTopTab Ìò∏Ï∂úÎê®, target:', target);
            const chatView = document.getElementById('chat-view');
            const myView = document.getElementById('mypage-view');
            const btnChat = document.getElementById('navChatbot');
            const btnMy = document.getElementById('navMypage');
            console.log('Î≤ÑÌäº ÏöîÏÜåÎì§:', btnChat, btnMy);
            if (target === 'mypage'){
                chatView.classList.add('hidden');
                myView.classList.remove('hidden');
                // hjs ÏàòÏ†ï: Î≤ÑÌäº Ïä§ÌÉÄÏùº ÎèôÍ∏∞Ìôî (ÎßàÏù¥ÌéòÏù¥ÏßÄ ÏÑ†ÌÉùÏãú ÏßÑÌïú ÎÖπÏÉâ)
                btnChat.className = 'nav-btn px-4 py-2 bg-white text-green-600 border-2 border-green-600 rounded-lg font-medium transition duration-300 hover:bg-gray-50';
                btnMy.className = 'nav-btn active px-4 py-2 bg-green-600 text-white rounded-lg font-medium transition duration-300 hover:bg-green-700';
                console.log('ÎßàÏù¥ÌéòÏù¥ÏßÄ ÏÑ†ÌÉùÎê® - Ï±óÎ¥á Î≤ÑÌäº ÌÅ¥ÎûòÏä§:', btnChat.className);
                console.log('ÎßàÏù¥ÌéòÏù¥ÏßÄ ÏÑ†ÌÉùÎê® - ÎßàÏù¥ÌéòÏù¥ÏßÄ Î≤ÑÌäº ÌÅ¥ÎûòÏä§:', btnMy.className);
                try { showContent('orders'); } catch(_){ }
            } else {
                myView.classList.add('hidden');
                chatView.classList.remove('hidden');
                // hjs ÏàòÏ†ï: Î≤ÑÌäº Ïä§ÌÉÄÏùº ÎèôÍ∏∞Ìôî (Ï±óÎ¥á ÏÑ†ÌÉùÏãú ÏßÑÌïú ÎÖπÏÉâ)
                btnMy.className = 'nav-btn px-4 py-2 bg-white text-green-600 border-2 border-green-600 rounded-lg font-medium transition duration-300 hover:bg-gray-50';
                btnChat.className = 'nav-btn active px-4 py-2 bg-green-600 text-white rounded-lg font-medium transition duration-300 hover:bg-green-700';
                console.log('Ï±óÎ¥á ÏÑ†ÌÉùÎê® - ÎßàÏù¥ÌéòÏù¥ÏßÄ Î≤ÑÌäº ÌÅ¥ÎûòÏä§:', btnMy.className);
                console.log('Ï±óÎ¥á ÏÑ†ÌÉùÎê® - Ï±óÎ¥á Î≤ÑÌäº ÌÅ¥ÎûòÏä§:', btnChat.className);
            }
        }
        // ÌÉ≠ Ï†ÑÌôò Í∏∞Îä•
        function initializeTabs() {
            // Ï¢åÏ∏° Ìå®ÎÑê ÌÉ≠ (Î†àÏãúÌîº/Ï¶êÍ≤®Ï∞æÍ∏∞)
            const leftTabs = document.querySelectorAll('.left-panel .tab-btn');
            const leftContents = document.querySelectorAll('.left-panel .panel-content');
            
            leftTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.dataset.tab;
                    
                    // ÌÉ≠ Î≤ÑÌäº ÌôúÏÑ±Ìôî ÏÉÅÌÉú Î≥ÄÍ≤Ω
                    leftTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // ÏΩòÌÖêÏ∏† ÌëúÏãú/Ïà®ÍπÄ
                    leftContents.forEach(content => {
                        if (content.id === targetTab + 'Section') {
                            content.classList.add('active');
                        } else {
                            content.classList.remove('active');
                        }
                    });
                });
            });
            
            // Ïö∞Ï∏° Ìå®ÎÑê ÌÉ≠ (ÏÉÅÌíà/Ïû•Î∞îÍµ¨Îãà)
            const rightTabs = document.querySelectorAll('.right-panel .tab-btn');
            const rightContents = document.querySelectorAll('.right-panel .panel-content');
            
            rightTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.dataset.tab;
                    
                    // ÌÉ≠ Î≤ÑÌäº ÌôúÏÑ±Ìôî ÏÉÅÌÉú Î≥ÄÍ≤Ω
                    rightTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // ÏΩòÌÖêÏ∏† ÌëúÏãú/Ïà®ÍπÄ
                    rightContents.forEach(content => {
                        if (content.id === targetTab + 'Section') {
                            content.classList.add('active');
                        } else {
                            content.classList.remove('active');
                        }
                    });
                });
            });
        }

        // Ï¶êÍ≤®Ï∞æÍ∏∞ ÌÜ†Í∏Ä Í∏∞Îä•
        function toggleFavorite(button) {
            const icon = button.querySelector('i');
            if (icon.classList.contains('text-gray-300')) {
                icon.classList.remove('text-gray-300');
                icon.classList.add('text-yellow-400');
            } else {
                icon.classList.remove('text-yellow-400');
                icon.classList.add('text-gray-300');
            }
        }

        // Í∞ÄÏÉÅ Îç∞Ïù¥ÌÑ∞Î°ú Ïπ¥Îìú Î†åÎçîÎßÅ ÌÖåÏä§Ìä∏ (Í∞úÎ∞úÏö©)
        function loadSampleData() {
            // ÏÉòÌîå Î†àÏãúÌîº Îç∞Ïù¥ÌÑ∞
         

            // Î†àÏãúÌîº Ïπ¥Îìú Î†åÎçîÎßÅ
            // renderSampleRecipes(sampleRecipes);
            
            // ÏÉÅÌíà Í≤ÄÏÉâ ÏãúÏó∞ÏùÑ ÏúÑÌïú Î≤ÑÌäº Ïù¥Î≤§Ìä∏
            document.querySelector('[data-message="Ïù∏Í∏∞ ÏÉÅÌíà Ï∂îÏ≤úÌï¥Ï§ò"]').addEventListener('click', () => {
                renderSampleProducts(sampleProducts);
            });
        }

        function renderSampleRecipes(recipes) {
            const recipesList = document.getElementById('recipesList');
            recipesList.innerHTML = '';

            recipes.forEach(recipe => {
                const card = document.createElement('div');
                // hjs ÏàòÏ†ï: Î≥Ñ Î≤ÑÌäº ÌïòÎã® Í≥†Ï†ï ÏúÑÌï¥ relative Ï∂îÍ∞Ä
                card.className = 'recipe-card relative bg-white rounded-lg p-3 border hover:shadow-md transition cursor-pointer mb-2';
                card.innerHTML = `
                    <div class="recipe-card-body">
                        <h4 class="font-semibold text-gray-800 mb-2">${recipe.title}</h4>
                        <p class="text-gray-600 mb-2 text-xs">${recipe.description}</p>
                        <div class="flex items-center justify-between">
                            <div class="recipe-info flex gap-3 text-xs text-gray-500">
                                <span><i class="fas fa-clock mr-1"></i>${recipe.cooking_time}</span>
                                <span><i class="fas fa-user mr-1"></i>${recipe.servings}</span>
                            </div>
                            <button class="recipe-ingredients-btn bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-xs font-medium transition">
                                <i class="fas fa-shopping-basket mr-1"></i>Ïû¨Î£å Ï∂îÏ≤úÎ∞õÍ∏∞
                            </button>
                        </div>
                    </div>
                    <!-- hjs ÏàòÏ†ï: Ï¶êÍ≤®Ï∞æÍ∏∞ Î≤ÑÌäºÏùÑ Ï¢åÏ∏° ÌïòÎã®ÏúºÎ°ú Ïù¥Îèô -->
                    <button class="favorite-btn absolute bottom-3 left-3" onclick="toggleFavorite(this)">
                        <i class="fas fa-star text-gray-300"></i>
                    </button>
                `;
                
                // Ïû¨Î£å Ï∂îÏ≤ú Î≤ÑÌäº Ïù¥Î≤§Ìä∏ - chat_ver2.jsÏùò Ïã§Ï†ú Í∏∞Îä• ÏÇ¨Ïö©
                card.querySelector('.recipe-ingredients-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    // ChatBot Ïù∏Ïä§ÌÑ¥Ïä§Ïùò requestRecipeIngredients Î©îÏÜåÎìú Ìò∏Ï∂ú
                    if (window.chatbot && window.chatbot.requestRecipeIngredients) {
                        window.chatbot.requestRecipeIngredients(recipe);
                    }
                });
                
                recipesList.appendChild(card);
            });
        }

        function renderSampleProducts(products) {
            const productsSection = document.getElementById('productsSection');
            const productsList = document.getElementById('productsList');
            
            productsSection.classList.remove('hidden');
            productsList.innerHTML = '';

            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card bg-white rounded-lg p-3 border hover:shadow-md transition mb-2';
                card.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <h4 class="font-medium text-sm text-gray-800">${product.name}</h4>
                            <p class="text-xs text-gray-500 mt-1">${product.origin}</p>
                            <div class="flex items-center mt-1">
                                <p class="text-green-600 font-bold text-sm">${product.price.toLocaleString()}Ïõê</p>
                                ${product.organic ? '<span class="ml-2 px-1 py-0.5 bg-green-100 text-green-700 text-xs rounded">Ïú†Í∏∞ÎÜç</span>' : ''}
                            </div>
                        </div>
                        <button class="add-to-cart bg-green-100 text-green-600 px-2 py-1 rounded text-xs hover:bg-green-200 transition" 
                                data-product='${JSON.stringify(product)}'>
                            Îã¥Í∏∞
                        </button>
                    </div>
                `;
                
                // Ïû•Î∞îÍµ¨Îãà Îã¥Í∏∞ Î≤ÑÌäº Ïù¥Î≤§Ìä∏
                card.querySelector('.add-to-cart').addEventListener('click', (e) => {
                    e.stopPropagation();
                    const productData = JSON.parse(e.target.dataset.product);
                    addToSampleCart(productData);
                });
                
                productsList.appendChild(card);
            });

            // ÏÉÅÌíà ÌÉ≠ÏúºÎ°ú ÏûêÎèô Ï†ÑÌôò
            document.getElementById('productTab').click();
        }

        // ÏÉòÌîå Ïû•Î∞îÍµ¨Îãà Í∏∞Îä•
        let sampleCart = [];

        function addToSampleCart(product) {
            const existingItem = sampleCart.find(item => item.name === product.name);
            
            if (existingItem) {
                existingItem.qty += 1;
            } else {
                sampleCart.push({
                    name: product.name,
                    unit_price: product.price,
                    qty: 1
                });
            }
            
            updateSampleCart();
            
            // ÏÑ±Í≥µ Î©îÏãúÏßÄ
            alert(`"${product.name}"Í∞Ä Ïû•Î∞îÍµ¨ÎãàÏóê Îã¥Í≤ºÏäµÎãàÎã§!`);
        }

        function updateSampleCart() {
            const cartItems = document.getElementById('cartItems');
            const cartCount = document.getElementById('cartCount');
            const subtotalAmount = document.getElementById('subtotalAmount');
            const totalAmount = document.getElementById('totalAmount');
            const checkoutButton = document.getElementById('checkoutButton');

            if (sampleCart.length === 0) {
                cartItems.innerHTML = '<div class="cart-empty p-4 text-center text-gray-500">Ïû•Î∞îÍµ¨ÎãàÍ∞Ä ÎπÑÏñ¥ÏûàÏäµÎãàÎã§.</div>';
                cartCount.textContent = '0';
                subtotalAmount.textContent = '0Ïõê';
                totalAmount.textContent = '0Ïõê';
                checkoutButton.classList.add('hidden');
                return;
            }

            cartCount.textContent = sampleCart.length;
            cartItems.innerHTML = '';

            let subtotal = 0;

            sampleCart.forEach((item, index) => {
                const itemTotal = item.unit_price * item.qty;
                subtotal += itemTotal;

                const itemDiv = document.createElement('div');
                itemDiv.className = 'cart-item flex items-center justify-between bg-white rounded p-2 text-sm mb-2';
                itemDiv.innerHTML = `
                    <div class="flex-1 mr-2">
                        <span class="font-medium">${item.name}</span>
                        <div class="text-xs text-gray-500">${item.unit_price.toLocaleString()}Ïõê</div>
                    </div>
                    <div class="quantity-controls flex items-center">
                        <button class="quantity-btn minus-btn w-6 h-6 border rounded flex items-center justify-center" onclick="updateSampleCartQty(${index}, -1)">-</button>
                        <span class="quantity-display mx-2">${item.qty}</span>
                        <button class="quantity-btn plus-btn w-6 h-6 border rounded flex items-center justify-center" onclick="updateSampleCartQty(${index}, 1)">+</button>
                    </div>
                    <button class="remove-item ml-2 text-red-500 hover:text-red-700" onclick="removeSampleCartItem(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                cartItems.appendChild(itemDiv);
            });

            subtotalAmount.textContent = subtotal.toLocaleString() + 'Ïõê';
            totalAmount.textContent = subtotal.toLocaleString() + 'Ïõê';
            checkoutButton.classList.remove('hidden');
        }

        function updateSampleCartQty(index, change) {
            if (index >= 0 && index < sampleCart.length) {
                sampleCart[index].qty += change;
                if (sampleCart[index].qty <= 0) {
                    sampleCart.splice(index, 1);
                }
                updateSampleCart();
            }
        }

        function removeSampleCartItem(index) {
            if (index >= 0 && index < sampleCart.length) {
                sampleCart.splice(index, 1);
                updateSampleCart();
            }
        }

        // hjs ÏàòÏ†ï: DOM Î°úÎìú Ïãú ÏÉòÌîå Î°úÏßÅ Ï†úÍ±∞, Ïã§Ï†ú UIÎßå Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', () => {
            initializeTabs();
            // hjs ÏàòÏ†ï: Ïπ¥Ìä∏ ÏÑ†ÌÉù Ìà¥Î∞î Ïù¥Î≤§Ìä∏ Î∞îÏù∏Îî©
            const selectAll = document.getElementById('cartSelectAll');
            const selectNone = document.getElementById('cartSelectNone');
            if (selectAll){ selectAll.addEventListener('click', ()=>{
                document.querySelectorAll('.cart-select').forEach(cb => { cb.checked = true; });
                if (window._chatbot && window._chatbot.recalculateCartTotals) window._chatbot.recalculateCartTotals();
            }); }
            if (selectNone){ selectNone.addEventListener('click', ()=>{
                document.querySelectorAll('.cart-select').forEach(cb => { cb.checked = false; });
                if (window._chatbot && window._chatbot.recalculateCartTotals) window._chatbot.recalculateCartTotals();
            }); }
        });
    </script>
    
    <!-- Î°úÍ∑∏ÏïÑÏõÉ Í∏∞Îä• -->
    <script>
        
         async function logout() {
            // hjs ÏàòÏ†ï: Í∞ÑÎã®Ìïú Ìè¥Î∞± Ï∂îÍ∞Ä ‚Äî /auth/logout Ïã§Ìå® Ïãú /auth/logout-beacon Ìò∏Ï∂ú
            const clearLocal = () => {
              try {
                const u = JSON.parse(localStorage.getItem('user_info')||'{}');
                const uid = u.user_id || '';
                localStorage.removeItem('access_token');
                if (uid){
                  localStorage.removeItem(`chat_messages_${uid}`);
                  localStorage.removeItem(`chat_session_${uid}`);
                  localStorage.removeItem(`chat_pending_message_${uid}`);
                }
                localStorage.removeItem('user_info');
              } catch(_) {}
            };
            try {
              const token = localStorage.getItem('access_token');
              const headers = { 'Content-Type': 'application/json' };
              if (token) headers['Authorization'] = `Bearer ${token}`;
              const res = await fetch('/auth/logout', { method:'POST', headers, credentials:'include' });
              if (res.ok) { clearLocal(); window.location.href='/'; return; }
              // Ìè¥Î∞±: Í∂åÌïú ÏóÜÏù¥ Ïø†ÌÇ§Îßå Ï†úÍ±∞
              await fetch('/auth/logout-beacon', { method:'POST', credentials:'include' });
              clearLocal(); window.location.href='/';
            } catch (e) {
              console.error('Î°úÍ∑∏ÏïÑÏõÉ Ïò§Î•ò:', e);
              try { await fetch('/auth/logout-beacon', { method:'POST', credentials:'include' }); } catch(_) {}
              clearLocal(); window.location.href='/';
            }
         }
    </script>
</body>
</html>
